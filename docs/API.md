# ToDo.md API Reference

Complete REST API documentation for the ToDo.md server.

---

## Overview

ToDo.md exposes a JSON REST API for managing projects, tasks, daily planning files, inbox items, and the underlying Markdown file system.

| Detail | Value |
|---|---|
| **Base URL** | `http://localhost:3000` |
| **Content-Type** | `application/json` for all request and response bodies |
| **Authentication** | None. The API is unauthenticated and intended for local use only. |
| **Static files** | The server also serves static files from the project root (dashboard, IDE, etc.). |

---

## General Error Format

All endpoints return errors as JSON objects with an `error` field:

```json
{
  "error": "Human-readable error message"
}
```

Common HTTP status codes used across the API:

| Code | Meaning |
|---|---|
| `200` | Success |
| `400` | Bad request -- missing or invalid parameters |
| `403` | Forbidden -- path blocked by security rules |
| `404` | Not found -- requested resource does not exist |
| `409` | Conflict -- file was modified externally (write conflict) |
| `500` | Internal server error |

### Path Security

All file-system endpoints enforce path safety rules. A request is rejected with `403` if the path:

- Resolves outside the project root directory.
- Contains `..` segments.
- Touches any blacklisted name: `node_modules`, `.git`, `.env`, `server.js`, `package.json`, `package-lock.json`.

Additionally, the following files are protected from deletion: `CLAUDE.md`, `README.md`, `server.js`, `package.json`, `dashboard.html`.

---

## Table of Contents

1. [Dashboard](#1-dashboard)
2. [Daily Planning](#2-daily-planning)
3. [Tasks](#3-tasks)
4. [Projects](#4-projects)
5. [Inbox](#5-inbox)
6. [File Management](#6-file-management)

---

## 1. Dashboard

### GET /api/dashboard

Retrieve the current dashboard data, which contains an overview of all projects, their tasks, ideas, and inbox items.

**Parameters:** None

**Response (200)**

```json
{
  "date": "2026-02-08",
  "projects": {
    "newsletter": {
      "tasks": [
        {
          "title": "Write newsletter draft",
          "due": "2026-02-10",
          "priority": "medium",
          "status": "todo",
          "tags": ["writing"]
        }
      ]
    }
  },
  "ideas": [],
  "inbox": []
}
```

**Error Response (500)**

```json
{
  "error": "Error message"
}
```

**Notes:**
- Dashboard data is read from `dashboard-data.json` at the project root.
- If the file does not exist, a default empty structure is returned with today's date.

---

## 2. Daily Planning

### GET /api/daily/ensure

Ensure that a daily planning file exists for a given date. If the file does not already exist, it is generated by scanning all project task files for tasks that are due on that date or overdue.

**Query Parameters**

| Parameter | Type | Required | Description |
|---|---|---|---|
| `date` | `string` | No | Date in `YYYY-MM-DD` format. Defaults to today. |

**Response (200)**

```json
{
  "success": true,
  "generated": true,
  "filePath": "daily/2026-02-08.md",
  "date": "2026-02-08"
}
```

| Field | Description |
|---|---|
| `generated` | `true` if a new file was created; `false` if it already existed. |
| `filePath` | Relative path to the daily file. |
| `date` | The resolved target date. |

**Error Response (500)**

```json
{
  "error": "Error message"
}
```

**Side Effects:**
- Creates the `daily/` directory if it does not exist.
- Scans every project's monthly task files under `projects/<key>/tasks/*.md`.
- Collects tasks with `status` other than `done` whose `due` date matches the target date (listed under "Today") or is before the target date (listed under "Overdue").
- Writes a Markdown file at `daily/<date>.md` with sections for Overdue tasks, Today's tasks, and Notes.

---

## 3. Tasks

### POST /api/tasks/create

Create a new task and add it to the appropriate project's current monthly task file.

**Request Body**

| Field | Type | Required | Default | Description |
|---|---|---|---|---|
| `title` | `string` | Yes | -- | Task title. |
| `projectName` | `string` | Yes | -- | Project key (directory name under `projects/`). |
| `priority` | `string` | No | `"medium"` | Priority level (e.g., `low`, `medium`, `high`). |
| `tags` | `string[]` | No | `[]` | Array of tag strings. |

**Request Example**

```json
{
  "title": "Write newsletter draft",
  "projectName": "newsletter",
  "priority": "high",
  "tags": ["writing", "content"]
}
```

**Response (200)**

```json
{
  "success": true,
  "message": "Task created"
}
```

**Error Responses**

| Code | Body |
|---|---|
| `400` | `{ "error": "Title and project name required" }` |
| `500` | `{ "error": "Error message" }` |

**Side Effects:**
- Creates the project directory and `tasks/` subdirectory if they do not exist.
- Creates the current month's task file (`YYYY-MM.md`) if it does not exist, with a standard header.
- Inserts a new task block into the "Active Tasks" section of the monthly file.
- The task is created with `status: todo`, an empty `due` field, and today's date as the `created` date.
- Updates `dashboard-data.json` with the new task.

---

### POST /api/tasks/done

Mark an existing active task as completed. Moves it from the "Active Tasks" section to the "Completed Tasks" section in its monthly file.

**Request Body**

| Field | Type | Required | Description |
|---|---|---|---|
| `taskTitle` | `string` | Yes | Exact title of the task (must match the `### ` heading). |
| `projectName` | `string` | Yes | Project key. |

**Request Example**

```json
{
  "taskTitle": "Write newsletter draft",
  "projectName": "newsletter"
}
```

**Response (200)**

```json
{
  "success": true,
  "message": "Task marked as done"
}
```

**Error Responses**

| Code | Body |
|---|---|
| `400` | `{ "error": "Task title and project name required" }` |
| `404` | `{ "error": "Task not found" }` |
| `500` | `{ "error": "Error message" }` |

**Side Effects:**
- Sets `status: done` in the task block.
- Adds or updates a `completed: YYYY-MM-DD` field with today's date.
- Physically moves the task block from the "Active Tasks" section to the "Completed Tasks" section in the monthly Markdown file.
- Creates the "Completed Tasks" section if it does not exist.
- Updates the task status in `dashboard-data.json`.

---

### POST /api/tasks/reschedule

Change the due date of an existing task.

**Request Body**

| Field | Type | Required | Description |
|---|---|---|---|
| `taskTitle` | `string` | Yes | Exact title of the task. |
| `project` | `string` | Yes | Project key. |
| `newDueDate` | `string` | Yes | New due date in `YYYY-MM-DD` format. |

**Request Example**

```json
{
  "taskTitle": "Write newsletter draft",
  "project": "newsletter",
  "newDueDate": "2026-02-15"
}
```

**Response (200)**

```json
{
  "success": true,
  "message": "Task rescheduled"
}
```

**Error Responses**

| Code | Body |
|---|---|
| `400` | `{ "error": "Task title, project, and new due date required" }` |
| `404` | `{ "error": "Task not found" }` |
| `500` | `{ "error": "Error message" }` |

**Side Effects:**
- Updates the `due:` line in the task block within the current month's task file.
- Updates the due date in `dashboard-data.json`.

---

### POST /api/tasks/sync-today

Synchronize a daily file's task check-states back to the project monthly files. Checked tasks are marked as done; unchecked tasks that do not yet exist in the monthly file are created.

**Request Body**

| Field | Type | Required | Description |
|---|---|---|---|
| `content` | `string` | Yes | Full Markdown content of the daily file. |
| `date` | `string` | Yes | Date in `YYYY-MM-DD` format (determines which monthly file to target). |

**Request Example**

```json
{
  "content": "# Saturday, February 8, 2026\n\n## Today\n- [x] Write newsletter draft (newsletter)\n- [ ] Review PR (open-source)\n",
  "date": "2026-02-08"
}
```

**Response (200)**

```json
{
  "success": true,
  "tasksCompleted": 1,
  "tasksCreated": 0
}
```

| Field | Description |
|---|---|
| `tasksCompleted` | Number of tasks marked as `done` in their monthly files. |
| `tasksCreated` | Number of new tasks created in monthly files (for unchecked tasks not already tracked). |

**Error Responses**

| Code | Body |
|---|---|
| `400` | `{ "error": "Content and date required" }` |
| `500` | `{ "error": "Error message" }` |

**Side Effects:**
- Parses lines matching `- [x] Task title (project)` and `- [ ] Task title (project)`.
- For checked tasks: sets `status: done`, adds `completed:` date, and moves the task block from "Active Tasks" to "Completed Tasks" in the monthly file.
- For unchecked tasks: creates a new task block in the "Active Tasks" section if the task does not already exist.
- Regenerates dashboard data.

---

## 4. Projects

### POST /api/projects/create

Create a new project with its full directory structure and initial files.

**Request Body**

| Field | Type | Required | Default | Description |
|---|---|---|---|---|
| `projectKey` | `string` | Yes | -- | URL-safe identifier. Must match `^[a-z0-9-]+$`. |
| `projectName` | `string` | Yes | -- | Human-readable project name. |
| `goal` | `string` | No | `""` | Description of the project's goal. |
| `targetDate` | `string` | No | `"ongoing"` | Target completion date or `"ongoing"`. |

**Request Example**

```json
{
  "projectKey": "my-project",
  "projectName": "My Project",
  "goal": "Launch the first module by March",
  "targetDate": "2026-03-31"
}
```

**Response (200)**

```json
{
  "success": true,
  "message": "Project created",
  "projectKey": "my-project",
  "projectPath": "projects/my-project"
}
```

**Error Responses**

| Code | Body |
|---|---|
| `400` | `{ "error": "Project key and name are required" }` |
| `400` | `{ "error": "Project key must be lowercase with hyphens only" }` |
| `400` | `{ "error": "Project already exists" }` |
| `500` | `{ "error": "Error message" }` |

**Side Effects:**
- Creates directory structure: `projects/<projectKey>/tasks/`.
- Creates `projects/<projectKey>/PROJECT.md` with metadata (type, status, target-date) and sections for Goal, Milestones, Progress, Key Context, and Notes.
- Creates the current month's task file at `projects/<projectKey>/tasks/YYYY-MM.md` with empty Active Tasks and Completed Tasks sections.

---

## 5. Inbox

### POST /api/inbox/process

Process an inbox item by either deleting it or converting it into a task within a project.

**Request Body**

| Field | Type | Required | Description |
|---|---|---|---|
| `inboxTitle` | `string` | Yes | Title of the inbox item (matched against `# <title>` in inbox files). |
| `action` | `string` | Yes | Either `"delete"` or `"convert-to-task"`. |
| `projectName` | `string` | Conditional | Required when `action` is `"convert-to-task"`. Project key to file the task under. |

**Request Example -- Delete**

```json
{
  "inboxTitle": "Random thought about branding",
  "action": "delete"
}
```

**Request Example -- Convert to Task**

```json
{
  "inboxTitle": "Draft blog post outline",
  "action": "convert-to-task",
  "projectName": "newsletter"
}
```

**Response (200)**

```json
{
  "success": true,
  "message": "Inbox item processed"
}
```

**Error Responses**

| Code | Body |
|---|---|
| `400` | `{ "error": "Inbox title and action required" }` |
| `404` | `{ "error": "Inbox item not found" }` |
| `500` | `{ "error": "Error message" }` |

**Side Effects:**
- Searches all `.md` files in the `inbox/` directory for a file containing `# <inboxTitle>`.
- `"delete"`: Permanently removes the inbox file from disk.
- `"convert-to-task"`: Creates a new task block in the project's current monthly file (in the "Active Tasks" section) with `priority: medium`, `status: todo`, and today's created date, then deletes the inbox file.
- Removes the item from the `inbox` array in `dashboard-data.json`.

---

## 6. File Management

These endpoints provide a general-purpose file system interface used by the built-in IDE. All paths are relative to the project root.

### GET /api/files/tree

Retrieve the full file tree of the project workspace.

**Parameters:** None

**Response (200)**

```json
{
  "tree": {
    "type": "directory",
    "name": "root",
    "path": "",
    "children": [
      {
        "type": "directory",
        "name": "daily",
        "path": "daily",
        "children": [
          {
            "type": "file",
            "name": "2026-02-08.md",
            "path": "daily/2026-02-08.md"
          }
        ]
      },
      {
        "type": "directory",
        "name": "projects",
        "path": "projects",
        "children": []
      }
    ]
  }
}
```

**Notes:**
- At the root level, only these directories are shown: `projects`, `daily`, `inbox`, `ideas`.
- Hidden files (starting with `.`), `node_modules`, and the `ide` directory are excluded at all levels.
- Directories are sorted before files; entries within each group are sorted alphabetically.

---

### GET /api/files/read

Read the content of a single file.

**Query Parameters**

| Parameter | Type | Required | Description |
|---|---|---|---|
| `path` | `string` | Yes | Relative file path (e.g., `projects/newsletter/tasks/2026-02.md`). |

**Response (200)**

```json
{
  "content": "# Newsletter - February 2026\n\n## Active Tasks\n...",
  "path": "projects/newsletter/tasks/2026-02.md",
  "stats": {
    "size": 1024,
    "modified": "2026-02-08T14:30:00.000Z"
  }
}
```

**Error Responses**

| Code | Body |
|---|---|
| `400` | `{ "error": "File path required" }` |
| `403` | `{ "error": "Invalid or unsafe file path" }` |
| `404` | `{ "error": "File not found" }` |
| `500` | `{ "error": "Error message" }` |

---

### POST /api/files/write

Write content to a file with optional conflict detection and automatic processing.

**Request Body**

| Field | Type | Required | Description |
|---|---|---|---|
| `path` | `string` | Yes | Relative file path. |
| `content` | `string` | Yes | Full file content to write. |
| `lastModified` | `string` | No | ISO 8601 timestamp from a previous read. If provided, the server checks for external modifications. |

**Request Example**

```json
{
  "path": "projects/newsletter/tasks/2026-02.md",
  "content": "# Newsletter - February 2026\n\n## Active Tasks\n...",
  "lastModified": "2026-02-08T14:30:00.000Z"
}
```

**Response (200)**

```json
{
  "success": true,
  "modified": "2026-02-08T14:35:00.000Z",
  "conflict": false
}
```

**Conflict Response (409)**

Returned when `lastModified` is provided and the file has been modified externally since that timestamp.

```json
{
  "error": "File modified externally",
  "conflict": true,
  "currentContent": "...current file content on disk..."
}
```

**Error Responses**

| Code | Body |
|---|---|
| `400` | `{ "error": "File path and content required" }` |
| `403` | `{ "error": "Invalid or unsafe file path" }` |
| `409` | See conflict response above. |
| `500` | `{ "error": "Error message" }` |

**Special Processing (Side Effects):**

This endpoint performs automatic processing depending on the file being saved:

| File | Behavior |
|---|---|
| `tasks.md` | Parses unchecked tasks in `- [ ] title \| due \| project` format. Tasks without a project are auto-assigned via LLM inference (OpenAI, Anthropic, or OpenRouter) if an LLM API key is configured, otherwise they default to `"others"`. Each parsed task is created in the appropriate project monthly file and the line in `tasks.md` is replaced with a strikethrough confirmation. Completed tasks exceeding 50 are archived to `tasks-archive-YYYY-MM.md`. |
| `inbox.md` | Inserts today's date header (`## YYYY-MM-DD`) if not already present. Entries older than 30 days are archived to `inbox-archive-YYYY-MM.md`. |
| `daily/*.md` | Checked tasks (`- [x] Title (project)`) are synced back to project monthly files -- marked as `done` with a `completed` date, and moved to the "Completed Tasks" section. |
| `projects/*/tasks/YYYY-MM.md` | After saving, if today's daily file exists, it is regenerated to reflect updated due dates and statuses. |

If automatic processing fails, the original content is written as-is and the save still succeeds.

---

### POST /api/files/create

Create a new file or directory.

**Request Body**

| Field | Type | Required | Default | Description |
|---|---|---|---|---|
| `path` | `string` | Yes | -- | Relative path for the new file or directory. |
| `type` | `string` | No | `"file"` | Either `"file"` or `"directory"`. |
| `content` | `string` | No | `""` | Initial content (only used when `type` is `"file"`). |

**Request Example**

```json
{
  "path": "ideas/product-roadmap.md",
  "type": "file",
  "content": "# Product Roadmap\n\n## Q1 Goals\n"
}
```

**Response (200)**

```json
{
  "success": true,
  "path": "ideas/product-roadmap.md"
}
```

**Error Responses**

| Code | Body |
|---|---|
| `400` | `{ "error": "File path required" }` |
| `400` | `{ "error": "File or directory already exists" }` |
| `403` | `{ "error": "Invalid or unsafe file path" }` |
| `500` | `{ "error": "Error message" }` |

**Notes:**
- Parent directories are created automatically if they do not exist.

---

### POST /api/files/delete

Delete a file or directory.

**Request Body**

| Field | Type | Required | Description |
|---|---|---|---|
| `path` | `string` | Yes | Relative path of the file or directory to delete. |

**Request Example**

```json
{
  "path": "ideas/old-brainstorm.md"
}
```

**Response (200)**

```json
{
  "success": true,
  "message": "File deleted"
}
```

**Error Responses**

| Code | Body |
|---|---|
| `400` | `{ "error": "File path required" }` |
| `403` | `{ "error": "Invalid or unsafe file path" }` |
| `403` | `{ "error": "Cannot delete protected system file" }` |
| `404` | `{ "error": "File not found" }` |
| `500` | `{ "error": "Error message" }` |

**Notes:**
- Directories are deleted recursively.
- Protected files (`CLAUDE.md`, `DECISIONS.md`, `README.md`, `server.js`, `package.json`, `dashboard.html`) cannot be deleted.

---

### POST /api/files/rename

Rename or move a file or directory.

**Request Body**

| Field | Type | Required | Description |
|---|---|---|---|
| `oldPath` | `string` | Yes | Current relative path. |
| `newPath` | `string` | Yes | Desired new relative path. |

**Request Example**

```json
{
  "oldPath": "ideas/brainstorm.md",
  "newPath": "ideas/brainstorm-v2.md"
}
```

**Response (200)**

```json
{
  "success": true,
  "newPath": "ideas/brainstorm-v2.md"
}
```

**Error Responses**

| Code | Body |
|---|---|
| `400` | `{ "error": "Old path and new path required" }` |
| `400` | `{ "error": "Destination already exists" }` |
| `403` | `{ "error": "Invalid or unsafe file path" }` |
| `404` | `{ "error": "Source file not found" }` |
| `500` | `{ "error": "Error message" }` |

---

### POST /api/files/mkdir

Create a new directory.

**Request Body**

| Field | Type | Required | Description |
|---|---|---|---|
| `path` | `string` | Yes | Relative directory path to create. |

**Request Example**

```json
{
  "path": "projects/new-project/tasks"
}
```

**Response (200)**

```json
{
  "success": true,
  "path": "projects/new-project/tasks"
}
```

**Error Responses**

| Code | Body |
|---|---|
| `400` | `{ "error": "Directory path required" }` |
| `400` | `{ "error": "Directory already exists" }` |
| `403` | `{ "error": "Invalid or unsafe directory path" }` |
| `500` | `{ "error": "Error message" }` |

**Notes:**
- Creates parent directories recursively if needed.

---

### POST /api/files/ensure-capture-files

Ensure that the quick-capture files (`inbox.md` and `tasks.md`) exist at the project root. Creates them with starter content if they are missing.

**Request Body:** None (empty object or no body).

**Response (200)**

```json
{
  "success": true,
  "created": ["inbox.md", "tasks.md"]
}
```

| Field | Description |
|---|---|
| `created` | Array of filenames that were newly created. Empty if both already existed. |

**Error Response (500)**

```json
{
  "error": "Error message"
}
```

**Side Effects:**
- `inbox.md` is created with an instruction comment and today's date header.
- `tasks.md` is created with an instruction comment, example tasks, and a "Your Tasks" section.

---

## Appendix

### Task Block Format

Tasks are stored as Markdown blocks within monthly files (`projects/<key>/tasks/YYYY-MM.md`). Each task follows this structure:

```markdown
---
### Task Title
due: 2026-02-15
priority: medium
status: todo
tags: [writing, content]
created: 2026-02-01

Task Title

**Notes:**

---
```

| Field | Values |
|---|---|
| `due` | `YYYY-MM-DD` or empty |
| `priority` | `low`, `medium`, `high` |
| `status` | `todo`, `in-progress`, `done` |
| `tags` | Comma-separated list in brackets |
| `created` | `YYYY-MM-DD` |
| `completed` | `YYYY-MM-DD` (added automatically when task is marked done) |

### Quick-Capture Task Format

Tasks written in `tasks.md` use a compact pipe-delimited format:

```
- [ ] Task title | YYYY-MM-DD | project-key
```

The project field is optional. If omitted, the server uses LLM inference to assign the task to the most appropriate project.

### Daily File Task Format

Tasks in daily files use checkbox format with the project in parentheses:

```
- [ ] Task title (project-key)
- [x] Completed task (project-key)
```

### Environment Variables

| Variable | Required | Description |
|---|---|---|
| `LLM_PROVIDER` | No | LLM provider: `openai`, `anthropic`, or `openrouter`. Auto-detected from key prefix if not set. |
| `LLM_API_KEY` | No | API key for your LLM provider. Provider is auto-detected from key prefix (`sk-` → OpenAI, `sk-ant-` → Anthropic, `sk-or-v1-` → OpenRouter). |
| `LLM_MODEL` | No | Override the default model. Defaults: `gpt-4o` (OpenAI), `claude-sonnet-4-5-20250929` (Anthropic), `anthropic/claude-sonnet-4-5` (OpenRouter). |
| `OPENROUTER_API_KEY` | No | Legacy. Equivalent to setting `LLM_API_KEY` with OpenRouter. Still works for backwards compatibility. |
