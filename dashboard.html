<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ToDo.md</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;450;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap');

  * { box-sizing: border-box; margin: 0; padding: 0; }
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }

  body {
    min-height: 100vh;
    background: #0a0a0b;
    color: #e5e7eb;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  }

  .mono { font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', monospace; }

  /* Header */
  .header {
    padding: 24px 32px 20px;
    border-bottom: 1px solid rgba(255,255,255,0.06);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .header-title { display: flex; align-items: center; gap: 10px; }
  .header-title .dot { font-size: 13px; color: #8b5cf6; font-weight: 600; }
  .header-title h1 { font-size: 18px; font-weight: 700; color: #f5f5f5; letter-spacing: -0.5px; }
  .header-date { font-size: 13px; color: #6b7280; margin-top: 4px; }
  .inbox-badge {
    display: flex; align-items: center; gap: 6px;
    padding: 6px 12px;
    background: rgba(245,158,11,0.1);
    border: 1px solid rgba(245,158,11,0.2);
    border-radius: 6px;
    font-size: 12px; color: #f59e0b; font-weight: 500;
  }

  /* Nav */
  .nav {
    padding: 12px 32px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    display: flex; gap: 4px;
  }
  .nav button {
    padding: 6px 16px;
    font-size: 13px;
    color: #6b7280;
    background: transparent;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-family: inherit;
    transition: all 0.15s;
  }
  .nav button.active { font-weight: 600; color: #f5f5f5; background: rgba(255,255,255,0.08); }
  .nav button:hover:not(.active) { color: #9ca3af; }

  /* Content */
  .content { padding: 24px 32px; max-width: 960px; margin: 0 auto; }

  /* Stats */
  .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 28px; }
  .stat-card {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 10px;
    padding: 16px 20px;
    text-align: center;
  }
  .stat-value { font-size: 32px; font-weight: 700; line-height: 1; }
  .stat-label { font-size: 11px; color: #6b7280; margin-top: 6px; text-transform: uppercase; letter-spacing: 1px; }
  .stat-sub { font-size: 11px; color: #4b5563; margin-top: 2px; }

  /* Sections */
  .section { margin-bottom: 24px; }
  .section-header {
    display: flex; align-items: center; gap: 8px;
    margin-bottom: 12px;
    font-size: 13px; font-weight: 600;
    text-transform: uppercase; letter-spacing: 1px;
  }
  .section-list {
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 8px;
    overflow: hidden;
  }

  /* Task Row */
  .task-row {
    display: flex; align-items: flex-start; gap: 10px;
    padding: 10px 14px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    transition: opacity 0.3s;
  }
  .task-row:last-child { border-bottom: none; }
  .task-row.checked { opacity: 0.4; }
  .task-row input[type="checkbox"] { margin-top: 3px; accent-color: #8b5cf6; cursor: pointer; width: 15px; height: 15px; }
  .task-title { font-size: 13.5px; color: #e5e7eb; font-weight: 450; }
  .task-row.checked .task-title { color: #6b7280; text-decoration: line-through; }
  .task-meta { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
  .task-tags { display: flex; gap: 4px; margin-top: 4px; flex-wrap: wrap; }
  .task-tags span { font-size: 10.5px; color: #6b7280; }

  /* Badge */
  .badge {
    display: inline-block;
    padding: 2px 8px;
    font-size: 11px;
    font-weight: 500;
    border-radius: 4px;
    letter-spacing: 0.3px;
  }

  /* Project Card */
  .projects-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
  .project-card {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 10px;
    padding: 20px;
  }
  .project-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 14px; }
  .project-emoji { font-size: 20px; margin-bottom: 2px; }
  .project-name { font-size: 14px; font-weight: 600; color: #e5e7eb; margin-top: 4px; }
  .project-pct { font-size: 26px; font-weight: 700; line-height: 1; }
  .project-count { font-size: 11px; color: #6b7280; margin-top: 2px; }
  .project-stats { display: flex; gap: 16px; margin-top: 14px; font-size: 12px; }
  .project-stats span.label { color: #6b7280; }
  .progress-bar { width: 100%; height: 5px; background: rgba(255,255,255,0.06); border-radius: 3px; overflow: hidden; }
  .progress-fill { height: 100%; border-radius: 3px; transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
  .milestone-box {
    margin-top: 14px; padding: 8px 10px;
    background: rgba(255,255,255,0.03);
    border-radius: 6px; font-size: 12px; color: #9ca3af;
  }
  .milestone-label { color: #6b7280; font-size: 10px; text-transform: uppercase; letter-spacing: 0.8px; display: block; margin-bottom: 2px; }

  /* Idea Row */
  .idea-row {
    display: flex; align-items: center; gap: 12px;
    padding: 14px 16px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
  }
  .idea-row:last-child { border-bottom: none; }
  .idea-title { font-size: 14px; color: #e5e7eb; font-weight: 500; flex: 1; }

  /* Footer */
  .footer {
    margin-top: 40px; padding: 16px 0;
    border-top: 1px solid rgba(255,255,255,0.04);
    display: flex; justify-content: space-between;
    font-size: 11px; color: #4b5563;
  }

  .hint { font-size: 12px; color: #4b5563; margin-top: 8px; }

  .hidden { display: none; }

  @media (max-width: 700px) {
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
    .projects-grid { grid-template-columns: 1fr; }
    .header, .nav, .content { padding-left: 16px; padding-right: 16px; }
  }
</style>
</head>
<body>

<div class="header">
  <div>
    <div class="header-title">
      <span class="dot mono">‚óÜ</span>
      <h1>ToDo.md</h1>
    </div>
    <div class="header-date mono" id="header-date"></div>
  </div>
  <div id="inbox-badge-container"></div>
</div>

<div class="nav" id="nav">
  <button class="active" data-view="today">Today</button>
  <button data-view="projects">Projects</button>
  <button data-view="ideas">Ideas</button>
</div>

<div class="content">
  <div class="stats-grid" id="stats-grid"></div>
  <div id="view-today"></div>
  <div id="view-projects" class="hidden"></div>
  <div id="view-ideas" class="hidden"></div>
  <div class="footer mono">
    <span>ToDo.md ‚Äî markdown-first task management</span>
    <span id="mode-indicator">powered by markdown + ai</span>
  </div>
</div>

<script>
// Dynamic color generation from project name
const ACCENT_PALETTE = ["#8b5cf6", "#ef4444", "#f59e0b", "#3b82f6", "#22c55e", "#ec4899", "#14b8a6", "#f97316"];
const PROJECT_ACCENTS = new Proxy({}, {
  get(target, prop) {
    if (prop in target) return target[prop];
    let hash = 0;
    for (let i = 0; i < String(prop).length; i++) hash = String(prop).charCodeAt(i) + ((hash << 5) - hash);
    return ACCENT_PALETTE[Math.abs(hash) % ACCENT_PALETTE.length];
  }
});

const PRIORITY_COLORS = {
  high: "#ef4444",
  medium: "#eab308",
  low: "#9ca3af"
};

let DATA = null;

// ‚îÄ‚îÄ Server Mode Detection ‚îÄ‚îÄ
let SERVER_MODE = false;

async function checkServerMode() {
  try {
    const resp = await fetch('/api/dashboard');
    if (resp.ok) {
      SERVER_MODE = true;
      return true;
    }
  } catch (e) {}
  return false;
}

// ‚îÄ‚îÄ Load Data ‚îÄ‚îÄ
async function loadData() {
  await checkServerMode();

  try {
    const url = SERVER_MODE ? '/api/dashboard' : 'dashboard-data.json';
    const resp = await fetch(url);
    if (!resp.ok) throw new Error('No data file');
    DATA = await resp.json();
  } catch (e) {
    // Fallback sample data so dashboard works out of the box
    DATA = getSampleData();
  }
  render();
}

function getSampleData() {
  return {
    date: new Date().toISOString().split('T')[0],
    projects: {
      "sample-project": {
        name: "Sample Project", emoji: "üìã", targetDate: "ongoing",
        tasks: [
          { title: "Review project roadmap", due: new Date().toISOString().split('T')[0], priority: "high", status: "todo", tags: ["planning"] },
          { title: "Set up weekly planning routine", due: new Date(Date.now() + 3*86400000).toISOString().split('T')[0], priority: "medium", status: "todo", tags: ["planning"] },
          { title: "Install ToDo.md", due: new Date(Date.now() - 86400000).toISOString().split('T')[0], priority: "high", status: "done", tags: ["setup"] },
        ],
        milestones: [
          { text: "Install ToDo.md", done: true },
          { text: "Create your first project", done: false },
          { text: "Add tasks and track progress", done: false },
        ]
      }
    },
    ideas: [
      { title: "Add calendar view to dashboard", status: "in-progress", tags: ["feature"] },
      { title: "Mobile-friendly task capture", status: "in-progress", tags: ["feature"] },
    ],
    inbox: [
      { title: "Try creating a new project", source: "setup", captured: "now" },
    ]
  };
}

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
function today() { return DATA.date; }

function formatDate(dateStr) {
  const d = new Date(dateStr + 'T12:00:00');
  return d.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
}

function daysOverdue(due) {
  return Math.floor((new Date(today()) - new Date(due)) / 86400000);
}

function badge(text, color) {
  return `<span class="badge mono" style="color:${color};background:${color}18;border:1px solid ${color}30">${text}</span>`;
}

function progressBar(pct, color) {
  return `<div class="progress-bar"><div class="progress-fill" style="width:${pct}%;background:${color}"></div></div>`;
}

function getStats(proj) {
  const total = proj.tasks.length;
  const done = proj.tasks.filter(t => t.status === 'done').length;
  const overdue = proj.tasks.filter(t => t.status !== 'done' && t.due < today()).length;
  const inProgress = proj.tasks.filter(t => t.status === 'in-progress').length;
  const pct = total ? Math.round((done / total) * 100) : 0;
  return { total, done, overdue, inProgress, pct };
}

function nextMilestone(proj) {
  const m = proj.milestones.find(m => !m.done);
  return m ? m.text : 'All complete ‚úì';
}

function esc(str) {
  if (!str) return '';
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

function taskRow(task, projectKey, projectName, showOverdue = false) {
  const accent = PROJECT_ACCENTS[projectKey] || '#8b5cf6';
  const pc = PRIORITY_COLORS[task.priority] || '#6b7280';
  const id = 'task-' + Math.random().toString(36).substr(2, 9);
  const checked = task.status === 'done';
  const tagHtml = task.tags ? task.tags.map(t => `<span class="mono">#${esc(t)}</span>`).join('') : '';
  const overdueBadge = showOverdue && task.daysLate ? badge(`${task.daysLate}d overdue`, '#ef4444') : '';

  const taskData = encodeURIComponent(JSON.stringify({ title: task.title, projectKey }));

  return `
    <div class="task-row ${checked ? 'checked' : ''}" id="${id}" data-task='${taskData}'>
      <input type="checkbox" ${checked ? 'checked' : ''} ${checked ? 'disabled' : ''} onchange="handleTaskToggle(this, ${esc(JSON.stringify(task.title))}, ${esc(JSON.stringify(projectKey))})">
      <div style="flex:1;min-width:0">
        <div class="task-meta">
          <span class="task-title">${esc(task.title)}</span>
          ${badge(esc(projectName), accent)}
          ${badge(esc(task.priority), pc)}
          ${overdueBadge}
        </div>
        ${tagHtml ? `<div class="task-tags">${tagHtml}</div>` : ''}
      </div>
    </div>`;
}

// ‚îÄ‚îÄ API Interactions ‚îÄ‚îÄ
async function handleTaskToggle(checkbox, taskTitle, projectKey) {
  if (!SERVER_MODE) {
    // In file-only mode, just toggle visually
    checkbox.parentElement.classList.toggle('checked');
    return;
  }

  try {
    checkbox.disabled = true;
    const resp = await fetch('/api/tasks/done', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ taskTitle, projectName: projectKey })
    });

    if (!resp.ok) throw new Error('Failed to mark task as done');

    checkbox.parentElement.classList.add('checked');
    checkbox.checked = true;

    // Reload data after a short delay
    setTimeout(loadData, 500);
  } catch (error) {
    console.error('Error marking task as done:', error);
    checkbox.checked = false;
    checkbox.disabled = false;
    alert('Failed to mark task as done. Make sure the server is running.');
  }
}

async function createTask(projectKey) {
  if (!SERVER_MODE) {
    alert('Server mode required for creating tasks. Run: npm start');
    return;
  }

  const title = prompt('Task title:');
  if (!title) return;

  const priority = prompt('Priority (high/medium/low):', 'medium');
  const tagsInput = prompt('Tags (comma-separated, optional):');
  const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()) : [];

  try {
    const resp = await fetch('/api/tasks/create', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ title, projectName: projectKey, priority, tags })
    });

    if (!resp.ok) throw new Error('Failed to create task');

    alert('Task created successfully!');
    loadData();
  } catch (error) {
    console.error('Error creating task:', error);
    alert('Failed to create task. Make sure the server is running.');
  }
}

async function processInboxItem(inboxTitle, action, projectKey = null) {
  if (!SERVER_MODE) {
    alert('Server mode required. Run: npm start');
    return;
  }

  try {
    const resp = await fetch('/api/inbox/process', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ inboxTitle, action, projectName: projectKey })
    });

    if (!resp.ok) throw new Error('Failed to process inbox item');

    loadData();
  } catch (error) {
    console.error('Error processing inbox:', error);
    alert('Failed to process inbox item. Make sure the server is running.');
  }
}

function processInboxItemPrompt(inboxTitle) {
  const projects = Object.keys(DATA.projects);
  const projectList = projects.map((p, i) => `${i + 1}. ${p}`).join('\n');
  const choice = prompt(`Convert "${inboxTitle}" to task.\n\nSelect project:\n${projectList}\n\nEnter number:`);

  if (!choice) return;

  const index = parseInt(choice) - 1;
  if (index >= 0 && index < projects.length) {
    processInboxItem(inboxTitle, 'convert-to-task', projects[index]);
  } else {
    alert('Invalid project number');
  }
}

// ‚îÄ‚îÄ Render ‚îÄ‚îÄ
function render() {
  const d = DATA;

  // Header
  document.getElementById('header-date').textContent = formatDate(today());

  // Mode indicator
  const modeIndicator = document.getElementById('mode-indicator');
  if (SERVER_MODE) {
    modeIndicator.innerHTML = '<span style="color:#22c55e">‚óè interactive mode</span>';
  } else {
    modeIndicator.textContent = 'powered by markdown + claude';
  }

  // Inbox badge
  const inboxContainer = document.getElementById('inbox-badge-container');
  if (d.inbox && d.inbox.length > 0) {
    inboxContainer.innerHTML = `<div class="inbox-badge"><span class="mono" style="font-weight:700">${d.inbox.length}</span> in inbox</div>`;
  }

  // Stats
  const allTasks = Object.values(d.projects).flatMap(p => p.tasks);
  const totalTasks = allTasks.length;
  const doneTasks = allTasks.filter(t => t.status === 'done').length;
  const inProgressTasks = allTasks.filter(t => t.status === 'in-progress').length;
  const overdueTasks = allTasks.filter(t => t.status !== 'done' && t.due < today()).length;

  document.getElementById('stats-grid').innerHTML = `
    <div class="stat-card"><div class="stat-value mono" style="color:#e5e7eb">${totalTasks}</div><div class="stat-label">Total</div></div>
    <div class="stat-card"><div class="stat-value mono" style="color:#22c55e">${doneTasks}</div><div class="stat-label">Done</div><div class="stat-sub">${Math.round((doneTasks/totalTasks)*100)}% complete</div></div>
    <div class="stat-card"><div class="stat-value mono" style="color:#3b82f6">${inProgressTasks}</div><div class="stat-label">In Progress</div></div>
    <div class="stat-card"><div class="stat-value mono" style="color:${overdueTasks > 0 ? '#ef4444' : '#6b7280'}">${overdueTasks}</div><div class="stat-label">Overdue</div></div>
  `;

  // ‚îÄ‚îÄ TODAY VIEW ‚îÄ‚îÄ
  let todayHtml = '';

  // Due today
  const dueTodayTasks = [];
  Object.entries(d.projects).forEach(([key, proj]) => {
    proj.tasks.forEach(t => {
      if (t.due === today() && t.status !== 'done') dueTodayTasks.push({ ...t, projectKey: key, projectName: proj.name });
    });
  });
  if (dueTodayTasks.length) {
    todayHtml += `<div class="section">
      <div class="section-header" style="color:#ef4444"><span>‚óè</span> Must Do Today</div>
      <div class="section-list">${dueTodayTasks.map(t => taskRow(t, t.projectKey, t.projectName)).join('')}</div>
    </div>`;
  }

  // Overdue
  const overdueList = [];
  Object.entries(d.projects).forEach(([key, proj]) => {
    proj.tasks.forEach(t => {
      if (t.due < today() && t.status !== 'done') overdueList.push({ ...t, projectKey: key, projectName: proj.name, daysLate: daysOverdue(t.due) });
    });
  });
  overdueList.sort((a, b) => b.daysLate - a.daysLate);
  if (overdueList.length) {
    todayHtml += `<div class="section">
      <div class="section-header" style="color:#eab308"><span>‚óè</span> Overdue</div>
      <div class="section-list">${overdueList.map(t => taskRow(t, t.projectKey, t.projectName, true)).join('')}</div>
    </div>`;
  }

  // Ideas in progress
  const activeIdeas = d.ideas.filter(i => i.status === 'in-progress');
  if (activeIdeas.length) {
    todayHtml += `<div class="section">
      <div class="section-header" style="color:#8b5cf6"><span>‚óè</span> Ideas in Progress</div>
      <div class="section-list">${activeIdeas.map(idea => `
        <div class="idea-row">
          <span style="color:#8b5cf6;font-size:14px">‚óá</span>
          <span class="idea-title">${idea.title}</span>
          <div style="display:flex;gap:4px">${idea.tags.map(t => `<span class="mono" style="font-size:10.5px;color:#6b7280">#${t}</span>`).join('')}</div>
        </div>`).join('')}</div>
    </div>`;
  }

  // Inbox
  if (d.inbox && d.inbox.length) {
    const inboxItems = d.inbox.map(item => {
      const actions = SERVER_MODE ? `
        <button onclick="processInboxItemPrompt('${item.title.replace(/'/g, "\\'")}')" style="padding:4px 10px;background:#8b5cf620;border:1px solid #8b5cf640;color:#8b5cf6;border-radius:4px;cursor:pointer;font-size:11px;font-weight:600;font-family:inherit;margin-left:8px">Convert</button>
        <button onclick="processInboxItem('${item.title.replace(/'/g, "\\'")}', 'delete')" style="padding:4px 10px;background:#ef444420;border:1px solid #ef444440;color:#ef4444;border-radius:4px;cursor:pointer;font-size:11px;font-weight:600;font-family:inherit;margin-left:4px">Delete</button>
      ` : '';
      return `
        <div class="idea-row">
          <span style="color:#f59e0b;font-size:12px">‚Üí</span>
          <span class="idea-title" style="font-size:13.5px">${item.title}</span>
          <div style="margin-left:auto;display:flex;align-items:center;gap:4px">
            ${badge(item.source, '#f59e0b')}
            ${actions}
          </div>
        </div>`;
    }).join('');

    const hint = SERVER_MODE ? '' : '<div class="hint mono">use the IDE to sort these ‚Üí</div>';
    todayHtml += `<div class="section">
      <div class="section-header" style="color:#f59e0b"><span>‚óè</span> Inbox (${d.inbox.length} unsorted)</div>
      <div class="section-list">${inboxItems}</div>
      ${hint}
    </div>`;
  }

  document.getElementById('view-today').innerHTML = todayHtml;

  // ‚îÄ‚îÄ PROJECTS VIEW ‚îÄ‚îÄ
  let projHtml = '<div class="projects-grid">';
  Object.entries(d.projects).forEach(([key, proj]) => {
    const stats = getStats(proj);
    const accent = PROJECT_ACCENTS[key] || '#8b5cf6';
    const nm = nextMilestone(proj);
    const newTaskBtn = SERVER_MODE ? `<button onclick="createTask('${key}')" style="margin-top:12px;padding:8px 14px;width:100%;background:${accent}20;border:1px solid ${accent}40;color:${accent};border-radius:6px;cursor:pointer;font-size:12px;font-weight:600;font-family:inherit">+ New Task</button>` : '';
    projHtml += `
      <div class="project-card" style="border-top:3px solid ${accent}">
        <div class="project-header">
          <div>
            <div class="project-emoji">${proj.emoji}</div>
            <div class="project-name">${proj.name}</div>
          </div>
          <div style="text-align:right">
            <div class="project-pct mono" style="color:${accent}">${stats.pct}%</div>
            <div class="project-count">${stats.done}/${stats.total} tasks</div>
          </div>
        </div>
        ${progressBar(stats.pct, accent)}
        <div class="project-stats">
          <div><span class="label">In progress </span><span style="color:#3b82f6;font-weight:600">${stats.inProgress}</span></div>
          <div><span class="label">Overdue </span><span style="color:${stats.overdue > 0 ? '#ef4444' : '#6b7280'};font-weight:600">${stats.overdue}</span></div>
        </div>
        ${nm ? `<div class="milestone-box" style="border-left:2px solid ${accent}40"><span class="milestone-label">Next milestone</span>${nm}</div>` : ''}
        ${newTaskBtn}
      </div>`;
  });
  projHtml += '</div>';
  document.getElementById('view-projects').innerHTML = projHtml;

  // ‚îÄ‚îÄ IDEAS VIEW ‚îÄ‚îÄ
  let ideasHtml = '<div class="section-list">';
  d.ideas.forEach(idea => {
    const active = idea.status === 'in-progress';
    ideasHtml += `
      <div class="idea-row">
        <span style="color:${active ? '#8b5cf6' : '#4b5563'};font-size:14px">${active ? '‚óÜ' : '‚óá'}</span>
        <div class="idea-title">${idea.title}</div>
        ${badge(idea.status, active ? '#8b5cf6' : '#6b7280')}
        <div style="display:flex;gap:4px">${idea.tags.map(t => `<span class="mono" style="font-size:10.5px;color:#6b7280">#${t}</span>`).join('')}</div>
      </div>`;
  });
  ideasHtml += '</div>';
  document.getElementById('view-ideas').innerHTML = ideasHtml;
}

// ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ
document.getElementById('nav').addEventListener('click', function(e) {
  if (e.target.tagName !== 'BUTTON') return;
  const view = e.target.dataset.view;

  this.querySelectorAll('button').forEach(b => b.classList.remove('active'));
  e.target.classList.add('active');

  document.getElementById('view-today').classList.toggle('hidden', view !== 'today');
  document.getElementById('view-projects').classList.toggle('hidden', view !== 'projects');
  document.getElementById('view-ideas').classList.toggle('hidden', view !== 'ideas');
});

// ‚îÄ‚îÄ Auto-reload every 30 seconds ‚îÄ‚îÄ
setInterval(loadData, 30000);

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
loadData();
</script>
</body>
</html>
